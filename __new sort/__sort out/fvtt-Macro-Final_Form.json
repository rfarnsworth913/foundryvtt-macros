{
  "_id": "CXhLFsg8hl1C06U6",
  "name": "Final Form",
  "type": "script",
  "sort": 100001,
  "flags": {
    "macro-marker": {
      "activeData": {
        "icon": "icons/svg/dice-target.svg",
        "tooltip": "New Macro",
        "colour": "#ff0000",
        "trigger": ""
      }
    },
    "exportSource": {
      "world": "pathfinder-society",
      "system": "pf2e",
      "coreVersion": "0.7.9",
      "systemVersion": "1.13.2.5430"
    }
  },
  "scope": "global",
  "command": "const RAGE_DAMAGE = 1;\n\n(async () => {\n    if (actor) {\n        for ( let token of canvas.tokens.controlled ) {\n            let messageContent = '';\n                if ((token.actor.data.data.customModifiers['deception'] || []).some(modifier => modifier.name === 'Final Form')) {\n                    await actor.removeCustomModifier(\"damage\", \"Final Form\");\n                    /// Remove the line below if you do not wish for your character to lose all temp hp when toggled \"off\".\n                    await actor.update({ \"data.attributes.hp.temp\": 0 });\n                    /// Remove the line above if you do not wish for your character to lose all temp hp when toggled \"off\".\n                    await token.actor.removeCustomModifier('deception', 'Final Form');\n                    await actor.removeCustomModifier(\"fortitude\", \"Final Form\");\n                    await actor.removeCustomModifier(\"reflex\", \"Final Form\");\n                    await actor.removeCustomModifier(\"will\", \"Final Form\");                    \n                    await token.update({\"img\" : \"https://i.imgur.com/nL9m6z5.png\"});\n                    await token.update({\"width\": 1, \"height\": 1});          \nif (\n          token.data.effects.includes(\n            \"https://i.imgur.com/CvbcKJd.png\"\n          )\n        ) {\n          token.toggleEffect(\"https://i.imgur.com/CvbcKJd.png\");\n        }\n          messageContent = (`<div><h3 style='border-bottom: 3px solid black'>Shokotsu returns to normal.</h3></div>\n            <img src=\"https://i.imgur.com/yrkx0K0.jpg\" />\n            <div style=\"color:#131516;margin-top:4px;\">\n            The mystic energy that empowered Shokotsu, fades as he shrinks to normal as he becomes Drained 3...\n            </div>`)\n\n                } else {\n                    await actor.update({ \"data.attributes.hp.temp\": 40 });\n                    await actor.addCustomModifier(\"damage\", \"Final Form\", RAGE_DAMAGE, \"status\");\n                    await token.actor.addCustomModifier('deception', 'Final Form', +1, 'status');\n                    await actor.addCustomModifier(\"fortitude\", \"Final Form\", +1, \"status\");\n                    await actor.addCustomModifier(\"reflex\", \"Final Form\", +1, \"status\");\n                    await actor.addCustomModifier(\"will\", \"Final Form\", +1, \"status\");                    \n                    await token.update({\"img\" : \"https://i.imgur.com/g1YGZEo.png\"});\n                    await token.update({\"width\": 2, \"height\": 2});\n        if (\n          !token.data.effects.includes(\n            \"https://i.imgur.com/CvbcKJd.png\"\n          )\n        ) {\n          token.toggleEffect(\"https://i.imgur.com/CvbcKJd.png\");\n        }\n                    messageContent = (`<div><h3 style='border-bottom: 3px solid black'>Shokotsu enters his Final Form!</h3></div>\n            <img src=\"https://i.imgur.com/PRskoBN.png\" />\n            <div style=\"color:#131516;margin-top:4px;\">\n            Shokotsu embraces his monstrous blood making it his own, letting out an ear splitting scream that echos to the heavens and hells alike in rage, pain, and defiance as he begins to float off his feet. Reality buckles and twists under this sudden surge of power; his hands violently twist backwards to resemble his Rakshasa ancestry as red lightning twists and crackles around his enlarged form while pulsing with a malevolent red aura!\n            </div>\n            <div><h4 style='border-bottom: 3px solid black'><br>Effects of the Feat:</h4></div>\n            <div><h5 style='border-bottom: 3px solid black'>• Become size large. <br> • Gain 40 temporary Hit Points. <br> • Gain a fly Speed equal to your Speed. <br> • Gain Weakness 10 to Good. <br> • Your unarmed attacks and weapons deal 1 additional damage. <br> • Gain a claws unarmed attack that deals 2d8 slashing damage and has the agile and finesse traits. <br> • While in your final form, you can cast chilling darkness, fireball, and lightning bolt as 6th-level divine innate spells, once each per use of this feat.\n            <div style=\"border-bottom: 2px solid black;color:#131516;padding-bottom:4px;\"><b style=\"color:#990000\"></h5></div><div><h4 style='border-bottom: 3px solid black'>At the activation of this Feat, every creature within 10 feet of you is deafened and dazzled for 1 round unless they succeed at a Fortitude save using your class DC or spell DC, whichever is higher.</h4></div>`)\n\n                };\n                // create the message \n\n                if (messageContent !== '') {\n                    let chatData = {\n                        user: game.user._id,\n                        speaker: ChatMessage.getSpeaker(),\n                        content: messageContent,\n                    };\n\n                    await ChatMessage.create(chatData, {});\n                }\n        }\n    } else {\n        ui.notifications.warn(\"You must have an actor selected.\");\n    }\n})();",
  "author": "E8D8BpwBYbRmlRfq",
  "img": "https://i.imgur.com/CvbcKJd.png",
  "actorIds": []
}